import os
from io import StringIO
from pathlib import Path

import pandas as pd

from xclim.testing import TestDataSet

TD = Path(os.path.dirname(__file__)) / "testdata"


_rh_test_data = StringIO(
    """
tas,100,90,80,70,60,50,40,30,20
-20,"-20,0","-21,2","-22,5","-24,0","-25,7","-27,7","-30,1","-33,1","-37,1"
-18,"-18,0","-19,2","-20,6","-22,1","-23,8","-25,9","-28,3","-31,3","-35,4"
-16,"-16,0","-17,3","-18,6","-20,2","-22,0","-24,0","-26,5","-29,5","-33,7"
-14,"-14,0","-15,3","-16,7","-18,3","-20,1","-22,1","-24,6","-27,8","-32,0"
-12,"-12,0","-13,3","-14,7","-16,3","-18,2","-20,3","-22,8","-26,0","-30,3"
-10,"-10,0","-11,3","-12,8","-14,4","-16,3","-18,4","-21,0","-24,3","-28,7"
-8,"-8,0","-9,3","-10,8","-12,5","-14,4","-16,6","-19,2","-22,5","-27,0"
-6,"-6,0","-7,4","-8,9","-10,6","-12,5","-14,7","-17,4","-20,7","-25,3"
-4,"-4,0","-5,4","-6,9","-8,7","-10,6","-12,9","-15,6","-19,0","-23,6"
-2,"-2,0","-3,4","-5,0","-6,7","-8,7","-11,0","-13,8","-17,2","-21,9"
0,"0,0","-1,4","-3,0","-4,8","-6,8","-9,2","-12,0","-15,5","-20,3"
2,"2,0","0,5","-1,1","-2,9","-4,9","-7,3","-10,2","-13,7","-18,6"
4,"4,0","2,5","0,9","-1,0","-3,1","-5,5","-8,4","-12,0","-16,9"
6,"6,0","4,5","2,8","0,9","-1,2","-3,6","-6,6","-10,3","-15,3"
8,"8,0","6,5","4,8","2,9","0,7","-1,8","-4,8","-8,5","-13,6"
10,"10,0","8,4","6,7","4,8","2,6","0,1","-3,0","-6,8","-11,9"
12,"12,0","10,4","8,7","6,7","4,5","1,9","-1,2","-5,0","-10,3"
14,"14,0","12,4","10,6","8,6","6,4","3,7","0,6","-3,3","-8,6"
16,"16,0","14,4","12,5","10,5","8,2","5,6","2,4","-1,6","-7,0"
18,"18,0","16,3","14,5","12,4","10,1","7,4","4,2","0,2","-5,3"
20,"20,0","18,3","16,4","14,4","12,0","9,3","6,0","1,9","-3,6"
22,"22,0","20,3","18,4","16,3","13,9","11,1","7,8","3,6","-2,0"
24,"24,0","22,3","20,3","18,2","15,7","12,9","9,6","5,3","-0,4"
26,"26,0","24,2","22,3","20,1","17,6","14,8","11,3","7,1","1,3"
28,"28,0","26,2","24,2","22,0","19,5","16,6","13,1","8,8","2,9"
30,"30,0","28,2","26,2","23,9","21,4","18,4","14,9","10,5","4,6"
32,"32,0","30,1","28,1","25,8","23,2","20,3","16,7","12,2","6,2"
34,"34,0","32,1","30,0","27,7","25,1","22,1","18,5","13,9","7,8"
36,"36,0","34,1","32,0","29,6","27,0","23,9","20,2","15,7","9,5"
38,"38,0","36,1","33,9","31,6","28,9","25,7","22,0","17,4","11,1"
40,"40,0","38,0","35,9","33,5","30,7","27,6","23,8","19,1","12,7"
42,"42,0","40,0","37,8","35,4","32,6","29,4","25,6","20,8","14,4"
44,"44,0","42,0","39,8","37,3","34,5","31,2","27,3","22,5","16,0"
46,"46,0","43,9","41,7","39,2","36,3","33,0","29,1","24,2","17,6"
48,"48,0","45,9","43,6","41,1","38,2","34,9","30,9","25,9","19,2"
50,"50,0","47,9","45,6","43,0","40,1","36,7","32,6","27,6","20,8"
"""
)
_rh_test_table = pd.read_table(_rh_test_data, sep=",", decimal=",").set_index("tas")
_rh_test_table = _rh_test_table.set_axis(_rh_test_table.columns.astype(float), axis=1)
_rh_test_table = _rh_test_table.stack().reset_index()
RH_testdata = _rh_test_table.rename(columns={"level_1": "rh", 0: "dtas"}).to_xarray()
RH_testdata.tas.attrs["units"] = "degC"
RH_testdata.dtas.attrs["units"] = "degC"
RH_testdata.rh.attrs["units"] = "%"
